= Enterprise Setup

This guide covers setting up MavGuard in enterprise environments with private repositories, authentication, and security considerations.

== Enterprise Requirements

Enterprise environments typically require:

* **Private Maven repositories** (Nexus, Artifactory)
* **Authentication and authorization** 
* **Proxy server support**
* **Network security compliance**
* **Centralized configuration management**
* **Audit logging and compliance**

== Nexus Repository Configuration

=== Basic Nexus Setup

[source,properties]
----
# ~/.mavguard/application.properties
mavguard.repository.type=nexus
mavguard.repository.url=https://nexus.company.com/repository/maven-public/
mavguard.repository.timeout=120s
----

=== Authentication Methods

==== Username/Password Authentication

[source,properties]
----
# Configuration file (without credentials)
mavguard.repository.type=nexus
mavguard.repository.url=https://nexus.company.com/repository/maven-public/
mavguard.repository.username=${NEXUS_USERNAME}
mavguard.repository.password=${NEXUS_PASSWORD}
----

[source,bash]
----
# Environment variables (secure)
export NEXUS_USERNAME=service-account
export NEXUS_PASSWORD=secure-token-here
java -jar mav-guard-cli.jar check-updates pom.xml
----

==== Token-Based Authentication

[source,properties]
----
mavguard.repository.auth.type=token
mavguard.repository.username=${NEXUS_USERNAME}
mavguard.repository.password=${NEXUS_TOKEN}
----

==== Certificate Authentication

[source,properties]
----
# Client certificate authentication
mavguard.repository.ssl.keystore=/path/to/client.p12
mavguard.repository.ssl.keystore-password=${KEYSTORE_PASSWORD}
mavguard.repository.ssl.keystore-type=PKCS12
----

=== Multiple Repository Support

[source,properties]
----
# Primary enterprise repository
mavguard.repository.primary.url=https://nexus.company.com/repository/maven-public/
mavguard.repository.primary.username=${NEXUS_USERNAME}
mavguard.repository.primary.password=${NEXUS_PASSWORD}

# Fallback to Maven Central for OSS dependencies
mavguard.repository.fallback.url=https://repo1.maven.org/maven2/
mavguard.repository.fallback.enabled=true

# Repository precedence
mavguard.repository.order=primary,fallback
----

== Proxy Configuration

=== Corporate Proxy Setup

[source,properties]
----
# HTTP/HTTPS proxy configuration
mavguard.proxy.host=proxy.company.com
mavguard.proxy.port=8080
mavguard.proxy.protocol=http

# Proxy authentication
mavguard.proxy.username=${PROXY_USERNAME}
mavguard.proxy.password=${PROXY_PASSWORD}

# Non-proxy hosts
mavguard.proxy.nonproxyhosts=localhost,127.0.0.1,*.company.com
----

=== NTLM Proxy Support

[source,properties]
----
# Windows NTLM proxy
mavguard.proxy.auth.type=ntlm
mavguard.proxy.auth.domain=COMPANY_DOMAIN
mavguard.proxy.username=${DOMAIN_USERNAME}
mavguard.proxy.password=${DOMAIN_PASSWORD}
----

=== SSL/TLS Configuration

[source,properties]
----
# Trust store for corporate certificates
mavguard.ssl.truststore=/path/to/corporate-truststore.jks
mavguard.ssl.truststore-password=${TRUSTSTORE_PASSWORD}

# Disable hostname verification (if required)
mavguard.ssl.hostname-verification=false

# TLS version requirements
mavguard.ssl.protocol=TLSv1.2
----

== Centralized Configuration

=== Configuration Server Integration

[source,properties]
----
# Spring Cloud Config integration
mavguard.config.server.url=https://config.company.com
mavguard.config.server.application=mavguard
mavguard.config.server.profile=production

# Vault integration for secrets
mavguard.vault.enabled=true
mavguard.vault.host=vault.company.com
mavguard.vault.port=8200
mavguard.vault.scheme=https
mavguard.vault.authentication=TOKEN
mavguard.vault.token=${VAULT_TOKEN}
----

=== Configuration Profiles

**Development Profile** (`application-dev.properties`):
[source,properties]
----
mavguard.repository.url=https://nexus-dev.company.com/repository/maven-public/
logging.level.de.diedavids.mavguard=DEBUG
mavguard.cache.enabled=false
----

**Production Profile** (`application-prod.properties`):
[source,properties]
----
mavguard.repository.url=https://nexus.company.com/repository/maven-public/
logging.level.de.diedavids.mavguard=WARN
logging.file.name=/var/log/mavguard/application.log
mavguard.cache.enabled=true
mavguard.cache.ttl=4h
----

=== Environment-Specific Deployment

[source,bash]
----
# Development environment
java -Dspring.profiles.active=dev \
     -jar mav-guard-cli.jar analyze pom.xml

# Production environment  
java -Dspring.profiles.active=prod \
     -DNEXUS_USERNAME=prod-service-account \
     -DNEXUS_PASSWORD=${VAULT_NEXUS_TOKEN} \
     -jar mav-guard-cli.jar check-updates pom.xml
----

== Security Considerations

=== Credential Management

**Best Practices**:
* Never store credentials in configuration files committed to version control
* Use environment variables or external secret management
* Implement credential rotation policies
* Use service accounts with minimal required permissions

**Vault Integration Example**:
[source,bash]
----
#!/bin/bash
# fetch-credentials.sh

# Fetch credentials from Vault
NEXUS_TOKEN=$(vault kv get -field=token secret/mavguard/nexus)
PROXY_PASSWORD=$(vault kv get -field=password secret/mavguard/proxy)

# Export for MavGuard
export NEXUS_USERNAME=mavguard-service
export NEXUS_PASSWORD="$NEXUS_TOKEN"
export PROXY_USERNAME=mavguard-service  
export PROXY_PASSWORD="$PROXY_PASSWORD"

# Run MavGuard
java -jar mav-guard-cli.jar check-updates pom.xml
----

=== Network Security

[source,properties]
----
# Enforce HTTPS only
mavguard.repository.enforce-https=true

# Certificate validation
mavguard.ssl.verify-certificates=true
mavguard.ssl.verify-hostnames=true

# Connection timeouts for security
mavguard.repository.connect-timeout=30s
mavguard.repository.read-timeout=60s

# Rate limiting to prevent abuse
mavguard.repository.max-connections=10
mavguard.repository.max-connections-per-route=5
----

=== Audit Logging

[source,properties]
----
# Enable audit logging
logging.level.de.diedavids.mavguard.audit=INFO

# Structured logging for SIEM integration
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Log file configuration
logging.file.name=/var/log/mavguard/audit.log
logging.file.max-size=100MB
logging.file.max-history=30
----

## Enterprise Deployment

=== Docker Deployment

**Dockerfile**:
[source,dockerfile]
----
FROM openjdk:17-jre-slim

# Add enterprise CA certificates
COPY corporate-ca.crt /usr/local/share/ca-certificates/
RUN update-ca-certificates

# Create application user
RUN groupadd -r mavguard && useradd -r -g mavguard mavguard

# Copy application
COPY mav-guard-cli.jar /app/mav-guard-cli.jar
COPY application-prod.properties /app/application.properties

# Set permissions
RUN chown -R mavguard:mavguard /app
USER mavguard

WORKDIR /workspace
ENTRYPOINT ["java", "-jar", "/app/mav-guard-cli.jar"]
----

**Docker Compose**:
[source,yaml]
----
version: '3.8'
services:
  mavguard:
    build: .
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - NEXUS_USERNAME=${NEXUS_USERNAME}
      - NEXUS_PASSWORD=${NEXUS_PASSWORD}
      - PROXY_USERNAME=${PROXY_USERNAME}
      - PROXY_PASSWORD=${PROXY_PASSWORD}
    volumes:
      - ./projects:/workspace:ro
      - ./logs:/var/log/mavguard
    networks:
      - enterprise
      
networks:
  enterprise:
    driver: bridge
----

=== Kubernetes Deployment

**ConfigMap**:
[source,yaml]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: mavguard-config
data:
  application.properties: |
    mavguard.repository.type=nexus
    mavguard.repository.url=https://nexus.company.com/repository/maven-public/
    mavguard.proxy.host=proxy.company.com
    mavguard.proxy.port=8080
    logging.level.de.diedavids.mavguard=INFO
----

**Secret**:
[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: mavguard-secrets
type: Opaque
stringData:
  nexus-username: mavguard-service
  nexus-password: secure-token-here
  proxy-username: domain\\service-account
  proxy-password: proxy-password-here
----

**Job**:
[source,yaml]
----
apiVersion: batch/v1
kind: Job
metadata:
  name: mavguard-analysis
spec:
  template:
    spec:
      containers:
      - name: mavguard
        image: company/mavguard:latest
        env:
        - name: NEXUS_USERNAME
          valueFrom:
            secretKeyRef:
              name: mavguard-secrets
              key: nexus-username
        - name: NEXUS_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mavguard-secrets  
              key: nexus-password
        volumeMounts:
        - name: config
          mountPath: /app/application.properties
          subPath: application.properties
        - name: project
          mountPath: /workspace
        command: ["java", "-jar", "/app/mav-guard-cli.jar", "analyze", "/workspace/pom.xml"]
      volumes:
      - name: config
        configMap:
          name: mavguard-config
      - name: project
        persistentVolumeClaim:
          claimName: project-source
      restartPolicy: Never
----

## Monitoring and Alerting

=== Metrics Collection

[source,properties]
----
# Enable metrics
management.endpoints.web.exposure.include=health,metrics,prometheus
management.endpoint.health.show-details=always

# Custom metrics
mavguard.metrics.enabled=true
mavguard.metrics.repository.response-times=true
mavguard.metrics.analysis.duration=true
----

=== Health Checks

[source,bash]
----
#!/bin/bash
# health-check.sh

# Test repository connectivity
java -jar mav-guard-cli.jar check-updates sample/simple-project/pom.xml > /dev/null 2>&1

if [ $? -eq 0 ]; then
    echo "✅ MavGuard health check passed"
    exit 0
else
    echo "❌ MavGuard health check failed"
    exit 1
fi
----

=== Integration with Enterprise Monitoring

**Prometheus Integration**:
[source,yaml]
----
# prometheus.yml
scrape_configs:
  - job_name: 'mavguard'
    static_configs:
      - targets: ['mavguard:8080']
    metrics_path: '/actuator/prometheus'
----

**Grafana Dashboard**:
- Repository response times
- Analysis duration metrics
- Error rates and types
- Authentication success/failure rates

## Compliance and Governance

=== Audit Trail

[source,properties]
----
# Comprehensive audit logging
logging.level.de.diedavids.mavguard.audit=INFO

# Include user context
mavguard.audit.include-user=true
mavguard.audit.include-source-ip=true
mavguard.audit.include-project-info=true
----

=== License Compliance

MavGuard can be integrated with license compliance tools:

[source,bash]
----
# Generate dependency report for compliance
java -jar mav-guard-cli.jar analyze pom.xml --output-format=json > dependencies.json

# Process with license compliance tool
license-checker analyze dependencies.json
----

=== Data Governance

**Data Classification**:
* Dependency information: Internal use
* Update reports: Internal use  
* Configuration: Confidential
* Credentials: Restricted

**Data Retention**:
* Log files: 90 days
* Analysis reports: 1 year
* Audit trails: 7 years (compliance requirement)

For additional security guidance, see the <<../user-guide/configuration.adoc#security-considerations,Security Configuration Guide>>.